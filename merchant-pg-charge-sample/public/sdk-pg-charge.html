<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link href="./css/tailwind.css" rel="stylesheet">

  <style>
    .form-shadow {
      box-shadow: 0px 3px 3px -2px rgb(0 0 0 / 20%), 0px 3px 4px 0px rgb(0 0 0 / 14%), 0px 1px 8px 0px rgb(0 0 0 / 12%);
      font-family: "Roboto", "Helvetica", "Arial", sans-serif
    }
  </style>
</head>

<body class="bg-light">
  <div style="display:flex;flex:1;height:100vh;justify-content:center;align-items:center;padding:20px">
    <div class="form-shadow" style="padding:20px">
      <h5 style="margin-bottom: 0.35rem;font-size: 1.5rem;">ACME PAY</h5>
      <div>
        <h6 style="margin-bottom: 0.35rem;font-size: 1rem;">Order summary</h6>
        <p style="color: grey;margin-bottom: 0.35rem;">Items</p>
        <hr style="border-top:1px dashed #bbb">
        <div style="margin-left:20px;color:grey;">
          <div style="font-size:14px;font-weight:bold">iPhone</div>
          <div style="padding-left:50%;letter-spacing:0px;font-size:12px">
            <div><span style="font-weight:bold;display: inline;">item id</span>: P100-1222</div>
            <div><span style="font-weight:bold">name</span>: iPhone</div>
            <div><span style="font-weight:bold">variation name</span>: Black, 128GB</div>
            <div><span style="font-weight:bold">description</span>: string</div>
            <div><span style="font-weight:bold">quantity</span>: 1</div>
            <div><span style="font-weight:bold">amount</span>: 1</div>
            <div><span style="font-weight:bold">price</span>: 2100.5</div>
            <div><span style="font-weight:bold">original price</span>: 2300</div>
            <div><span style="font-weight:bold">categories</span>: phone</div>
          </div>
        </div>
        <p style="color: grey;">Fee</p>
        <hr style="border-top:1px dashed #bbb">
        <div style="margin-top: 20px;"></div>
        <div style="display:flex;flex:1;margin-left:20px;margin-top:20px;color:grey;font-size:12px">
          <div class="grid gap-6 items-end mb-6">
            <div class="relative">
              <input value="2100.5" type="text" id="small_outlined" disabled="true"
                class="block px-2.5 pb-1.5 w-full text-sm bg-transparent rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                placeholder=" " style="color: grey;font-size: 12px;padding: 5px 5px;" />
              <label for="small_outlined"
                class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-3 scale-75 top-1 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-1 peer-focus:scale-75 peer-focus:-translate-y-3 left-1">
                Amount</label>
            </div>
          </div>
          <div class="grid gap-6 items-end mb-6" style="margin-left: 50px;">
            <div class="relative">
              <input value="PHP" type="text" id="small_outlined" disabled="true"
                class="block px-2.5 pb-1.5 w-full text-sm bg-transparent rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                placeholder=" " style="color: grey;font-size: 12px;padding: 5px 5px;" />
              <label for="small_outlined"
                class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-3 scale-75 top-1 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-1 peer-focus:scale-75 peer-focus:-translate-y-3 left-1">
                Currency</label>
            </div>
          </div>
        </div>
        <p style="color: grey;">PG info</p>
        <hr style="border-top:1px dashed #bbb">
        <div style="margin-top: 20px;"></div>
        <div style="display:flex;flex:1;margin-left:20px;margin-top:20px;color:grey;font-size:12px">
          <div class="grid gap-6 items-end mb-6">
            <div class="relative">
              <input value="charge" type="text" id="small_outlined" disabled="true"
                class="block px-2.5 pb-1.5 w-full text-sm bg-transparent rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                placeholder=" " style="color: grey;font-size: 12px;padding: 5px 5px;" />
              <label for="small_outlined"
                class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-3 scale-75 top-1 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-1 peer-focus:scale-75 peer-focus:-translate-y-3 left-1">
                PG flow</label>
            </div>
          </div>
          <div class="grid gap-6 items-end mb-6" style="margin-left: 50px;">
            <div class="relative">
              <input value="xendit" type="text" id="small_outlined" disabled="true"
                class="block px-2.5 pb-1.5 w-full text-sm bg-transparent rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                placeholder=" " style="color: grey;font-size: 12px;padding: 5px 5px;" />
              <label for="small_outlined"
                class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-3 scale-75 top-1 z-10 origin-[0] bg-white dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-1 peer-focus:scale-75 peer-focus:-translate-y-3 left-1">
                PG name</label>
            </div>
          </div>
        </div>
        <div>
          <div>
            <button style="background-color: #004953; color: white;" type="button" class="w-100 btn btn-lg rounded-lg"
              id="bnpl-button" disabled>Pay with ACME PAY
            </button>
          </div>
        </div>
      </div>

      <script type="module" src="https://unpkg.com/@openfabric/merchant-sdk@1.0.0/dist/index.umd.min.js"></script>
      <script type="module">
        const authHost = `${window.location.origin}/api/of-auth`;
        const currentEnv = 'dev'
        const { OpenFabric } = OpenFabricMerchantSDK;

        // dummy data
        const partnerRefId = `MT${Date.now()}`
        const address_line_1 = "30th Street corner 11th Avenue Bonifacio Global City, Lane P, Taguig, 1634 Metro Manila";
        const post_code = "1634";
        const initOpenFabric = () => {
          partnerRefId
          const order = {
            partner_reference_id: partnerRefId,
            partner_redirect_success_url: `https://merchant-1.samples.dev.openfabric.co/sdk-pg-charge-success?merchant_ref=${partnerRefId}`,
            partner_redirect_fail_url: `https://merchant-1.samples.dev.openfabric.co/sdk-pg-charge-failed?merchant_ref=${partnerRefId}`,
            pg_name: "xendit",
            pg_flow: "charge",
            customer_info: {
              mobile_number: "+632 8855 8800",
              first_name: "John",
              email: "john.doe@gmail.com",
            },
            amount: 2100.50,
            currency: "PHP",
            transaction_details: {
              shipping_address: {
                country_code: "ph",
                address_line_1,
                post_code,
              },
              billing_address: {
                country_code: "ph",
                address_line_1,
                post_code,
              },
              items: [
                {
                  item_id: "P100-1222",
                  name: "iPhone",
                  variation_name: "Black, 128GB",
                  description: "string",
                  quantity: 1,
                  amount: 1,
                  price: 2100.50,
                  original_price: 2300,
                  categories: ["phone"],
                }
              ]
            }
          }

          // get access token from server
          fetch(authHost)
            .then(response => response.json())
            .then(({ access_token }) => {
              // initialize Open Fabric's SDK
              const openFabric = OpenFabric(
                access_token,
                `${window.location.origin}/orchestrated/pg-sample/payment-success`,
                `${window.location.origin}/orchestrated/pg-sample/payment-failed`
              ).setEnvironment(currentEnv);

              openFabric.createOrder(order)
              let bnplButton = document.getElementById("bnpl-button");

              openFabric.initialize().then(() => {
                bnplButton.disabled = false;
              });

              // [BUY NOW] button click handler to trigger Open Fabric's payment method
              bnplButton.onclick = function () {
                if (bnplButton.disabled) {
                  return;
                }
                bnplButton.innerHTML = "<div class=\"lds-ring\"><div></div><div></div><div></div><div></div></div>";
                openFabric.onclick = null;
                openFabric.startFlow();
              };
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
          initOpenFabric();
        });

      </script>

</body>

</html>